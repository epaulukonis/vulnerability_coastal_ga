library('raster')
library('rgdal')

##################Land area/Percent calculations; present
#0.6 (HIGH)----
setwd('E:\\FinalModels\\Scenarios')

#load image file, save.image(file='PAbase.RData')
rm(list=setdiff(ls(), c("c_basef", "cp_basef","out_presslrc","out_presslrcp","out_PAbasec","out_PAbasecp")))
#load in c_basef and cp_basef, for names; out_pressslrc/cp are total raster numbers for high thresh across region, out_PAbasec/cp for PA

out_cp<-as.data.frame(out_presslrcp)
names(out_cp)<-names(cp_basef)
out_c<-as.data.frame(out_presslrc)
names(out_c)<-names(c_basef)
out_c<-out_c[,c(1:3)]

setwd('E:\\FinalModels\\Scenarios\\Coastal_Species\\fix_species\\SSS')
sss<-raster('csss_basefn.tif')
sss_high<-sss[[1]]
sss_highc<-as.data.frame(cellStats(sss_high, 'sum'))
names(sss_highc)<-'sss_high'
out_c<-cbind(out_c,sss_highc)

setwd('E:\\FinalModels\\Scenarios')
cp_tot<-raster('cp_tot')
c_tot<-raster('c_tot')#one without ocean factored in

cp_tot_f<-cellStats(cp_tot, 'sum')
c_tot_f<-cellStats(c_tot, 'sum')

TA_cp<-cbind(cp_tot_f, (cp_tot_f*900)/1000000)
colnames(TA_cp)<-c('TRC','TA')
TA_cp<-as.data.frame(TA_cp)
TA_c<-cbind(c_tot_f, (c_tot_f*900)/1000000)
colnames(TA_c)<-c('TRC','TA')
TA_c<-as.data.frame(TA_c)


##all available area across relevant extent
#percent area
out_cpa<-(out_c/TA_c$TRC)*100
out_cppa<-(out_cp/TA_cp$TRC)*100
out_allpa<-cbind(out_cpa,out_cppa)

#total area (km2)
out_cta<-(out_c*900)/1000000
out_cpta<-(out_cp*900)/1000000
out_allta<-as.data.frame(cbind(out_cta, out_cpta))
names(out_allta)<-names(out_allpa)


##PA
#percent of total PA area (by ext)
out_PAcpa<-(out_PAbasec/TA_c$TRC)*100
out_PAcppa<-(out_PAbasecp/TA_cp$TRC)*100
out_allPApa<-as.data.frame(cbind(out_PAcpa,out_PAcppa))
names(out_allPApa)<-names(out_allpa)

##percent of PA of available habitat
out_PAchab<-(out_PAbasec/out_c)*100
out_PAcphab<-(out_PAbasecp/out_cp)*100
out_allPAhab<-as.data.frame(cbind(out_PAchab, out_PAcphab))
names(out_allPAhab)<-names(out_allpa)

#total area (km2)
out_PActa<-(out_PAbasec*900)/1000000
out_PAcpta<-(out_PAbasecp*900)/1000000
out_allPAta<-as.data.frame(cbind(out_PActa, out_PAcpta))
names(out_allPAta)<-names(out_allpa)

out_high<-rbind(out_allpa,out_allta, out_allPAhab, out_allPApa,out_allPAta)

namesx<-c('percent total','area total (km2)','percent PA avail hab', 'percent PA ext','area PA (km2)')
rownames(out_high)<-namesx
setwd('E:\\FinalModels\\Scenarios')
write.csv(out_high,"LandAreaCalculations_high.csv")

save.image(file='landareacalcshigh.RData')


#0.4 (MODERATE)----
setwd('E:\\FinalModels\\Scenarios')

#load image file, save.image(file='PAbaseMED.RData')
rm(list=setdiff(ls(), c("cmed_basef", "cpmed_basef","out_presslrc","out_presslrcp","out_PAbasec","out_PAbasecp")))
out_cp<-as.data.frame(out_presslrcp)
names(out_cp)<-names(cpmed_basef)
out_c<-as.data.frame(out_presslrc)
names(out_c)<-names(cmed_basef)
out_c<-out_c[,c(1:3)]

#add in corrected SSS
setwd('E:\\FinalModels\\Scenarios\\Coastal_Species\\fix_species\\SSS')
sss<-stack('csss_basefn.tif')
sss_med<-sss[[2]]
sss_medc<-as.data.frame(cellStats(sss_med, 'sum'))
names(sss_medc)<-'sss_med'
out_c<-cbind(out_c,sss_medc)


setwd('E:\\FinalModels\\Scenarios')
cp_tot<-raster('cp_tot')
c_tot<-raster('c_tot')#one without ocean factored in

cp_tot_f<-cellStats(cp_tot, 'sum')
c_tot_f<-cellStats(c_tot, 'sum')

TA_cp<-cbind(cp_tot_f, (cp_tot_f*900)/1000000)
colnames(TA_cp)<-c('TRC','TA')
TA_cp<-as.data.frame(TA_cp)
TA_c<-cbind(c_tot_f, (c_tot_f*900)/1000000)
colnames(TA_c)<-c('TRC','TA')
TA_c<-as.data.frame(TA_c)


##all available area
#percent area
out_cpa<-(out_c/TA_c$TRC)*100
out_cppa<-(out_cp/TA_cp$TRC)*100
out_allpa<-cbind(out_cpa,out_cppa)

#total area (km2)
out_cta<-(out_c*900)/1000000
out_cpta<-(out_cp*900)/1000000
out_allta<-as.data.frame(cbind(out_cta, out_cpta))
names(out_allta)<-names(out_allpa)

##PA
#percent of total PA area
out_PAcpa<-(out_PAbasec/TA_c$TRC)*100
out_PAcppa<-(out_PAbasecp/TA_cp$TRC)*100
out_allPApa<-as.data.frame(cbind(out_PAcpa,out_PAcppa))
names(out_allPApa)<-names(out_allpa)

##percent of PA of available habitat
out_PAchab<-(out_PAbasec/out_c)*100
out_PAcphab<-(out_PAbasecp/out_cp)*100
out_allPAhab<-as.data.frame(cbind(out_PAchab, out_PAcphab))
names(out_allPAhab)<-names(out_allpa)

#total area (km2)
out_PActa<-(out_PAbasec*900)/1000000
out_PAcpta<-(out_PAbasecp*900)/1000000
out_allPAta<-as.data.frame(cbind(out_PActa, out_PAcpta))
names(out_allPAta)<-names(out_allpa)

out_med<-rbind(out_allpa,out_allta, out_allPAhab, out_allPApa,out_allPAta)

namesx<-c('percent total','area total (km2)','percent PA avail hab', 'percent PA ext','area PA (km2)')
rownames(out_med)<-namesx
setwd('E:\\FinalModels\\Scenarios')
write.csv(out_med,"LandAreaCalculations_medium.csv")

save.image(file='landareacalcsmed.RData')

#optimal thresh (low)----
setwd('E:\\FinalModels\\Scenarios')

#load image file, save.image(file='PAbaseLOW.RData')
rm(list=setdiff(ls(), c("clow_basef", "cplow_basef","out_presslrc","out_presslrcp","out_PAbasec","out_PAbasecp")))
out_cp<-as.data.frame(out_presslrcp)
names(out_cp)<-names(cplow_basef)
out_c<-as.data.frame(out_presslrc)
names(out_c)<-names(clow_basef)
#out_c<-out_c[,c(1:3)]

#I believe I fixed the base to be consistent for this one, but we'll use it as  a check
# setwd('E:\\FinalModels\\Scenarios\\Coastal_Species\\fix_species\\SSS')
# sss<-stack('csss_basefn.tif')
# sss_med<-sss[[3]]
# sss_medc<-as.data.frame(cellStats(sss_med, 'sum'))
# names(sss_medc)<-'sss_med'
# out_c<-cbind(out_c,sss_medc)


setwd('E:\\FinalModels\\Scenarios')
cp_tot<-raster('cp_tot')
c_tot<-raster('c_tot')#one without ocean factored in

cp_tot_f<-cellStats(cp_tot, 'sum')
c_tot_f<-cellStats(c_tot, 'sum')

TA_cp<-cbind(cp_tot_f, (cp_tot_f*900)/1000000)
colnames(TA_cp)<-c('TRC','TA')
TA_cp<-as.data.frame(TA_cp)
TA_c<-cbind(c_tot_f, (c_tot_f*900)/1000000)
colnames(TA_c)<-c('TRC','TA')
TA_c<-as.data.frame(TA_c)


##all available area
#percent area
out_cpa<-(out_c/TA_c$TRC)*100
out_cppa<-(out_cp/TA_cp$TRC)*100
out_allpa<-cbind(out_cpa,out_cppa)

#total area (km2)
out_cta<-(out_c*900)/1000000
out_cpta<-(out_cp*900)/1000000
out_allta<-as.data.frame(cbind(out_cta, out_cpta))
names(out_allta)<-names(out_allpa)

##PA
#percent of total PA area
out_PAcpa<-(out_PAbasec/TA_c$TRC)*100
out_PAcppa<-(out_PAbasecp/TA_cp$TRC)*100
out_allPApa<-as.data.frame(cbind(out_PAcpa,out_PAcppa))
names(out_allPApa)<-names(out_allpa)

##percent of PA of available habitat
out_PAchab<-(out_PAbasec/out_c)*100
out_PAcphab<-(out_PAbasecp/out_cp)*100
out_allPAhab<-as.data.frame(cbind(out_PAchab, out_PAcphab))
names(out_allPAhab)<-names(out_allpa)

#total area (km2)
out_PActa<-(out_PAbasec*900)/1000000
out_PAcpta<-(out_PAbasecp*900)/1000000
out_allPAta<-as.data.frame(cbind(out_PActa, out_PAcpta))
names(out_allPAta)<-names(out_allpa)

out_low<-rbind(out_allpa,out_allta, out_allPAhab, out_allPApa,out_allPAta)

namesx<-c('percent total','area total (km2)','percent PA avail hab', 'percent PA ext','area PA (km2)')
rownames(out_low)<-namesx
setwd('E:\\FinalModels\\Scenarios')
write.csv(out_low,"LandAreaCalculations_low.csv")

save.image(file='landareacalcslow.RData')

#Change in land area availble for scenarios

#load image file, save.image(file='1mslrcp.RData')
rm(list=setdiff(ls(), c("c_basef", "cp_basef","out_presslrc","out_presslrcp","out_1mc","out_1mcp")))
#load in c_basef and cp_basef, for names; out_pressslrc/cp are total raster numbers for high thresh across region,

out_cp<-as.data.frame(out_presslrcp)
names(out_cp)<-names(cp_basef)
out_c<-as.data.frame(out_presslrc)
names(out_c)<-names(c_basef)
out_c<-out_c[,c(1:3)]




###############################
#1m----
############################################################ area change unde scenarios, PA/Total


#load image file, get raster count, write out to CSV if needed
rm(list=setdiff(ls(), c("c_basef", "cp_basef","out_presslrc","out_presslrcp","out_PAbasec","out_PAbasecp")))
#load in, for each scenario, the cp/c 'out' objects, which represent the total cell count that we can get area/% of change




###moderate
###low

#1.5m----
#2m----

#load image file, get raster count, write out to CSV if needed
#load in, for each scenario, the cp/c 'out' objects, which represent the total cell count that we can get area/% of change

#need c_basef, cp_basef

#load in environments for each set
###high; 2mslrc; read in for coast
out_slr2mc_h<-as.data.frame(out)
out_slr2mc_h<-t(out_slr2mc_h)
rownames(out_slr2mc_h)<-namesx
colnames(out_slr2mc_h)<-names(c_basef)
out_c<-as.data.frame(out_slr2mc_h)
out_c<-out_c[,c(1:3)]
setwd('C:\\Users\\eliza\\Documents\\UGA\\Thesis\\NicheModels_2019\\LandCalcs')
write.csv(out_c, '2mslr_coast_high.csv')

#read in sss 2m enviro
outsss<-t(as.data.frame(out))
sss_high<-as.data.frame(outsss[,1])
names(sss_high)<-'sss_high'
rownames(sss_high)<-NULL

out_c<-read.csv('2mslr_coast_high.csv')
out_c<-cbind(out_c,sss_high)
setwd('C:\\Users\\eliza\\Documents\\UGA\\Thesis\\NicheModels_2019\\LandCalcs')
write.csv(out_c,'2m_slr_coast_highf.csv')
#reprsents 2m slr for coastal species under high threshold

###high; 2mslrc; read in for coast plain
out_slr2mcp_h<-as.data.frame(out)
out_slr2mcp_h<-t(out_slr2mcp_h)
rownames(out_slr2mcp_h)<-namesx
colnames(out_slr2mcp_h)<-names(cp_basef)
out_cp<-as.data.frame(out_slr2mcp_h)
write.csv(out_c,'2m_slr_coastplain_highf.csv')
#reprsents 2m slr for coastal species under high threshold

#read in PA stuff, do same

#for total area
setwd('E:\\FinalModels\\Scenarios')
cp_tot<-raster('cp_tot')
c_tot<-raster('c_tot')#one without ocean factored in

cp_tot_f<-cellStats(cp_tot, 'sum')
c_tot_f<-cellStats(c_tot, 'sum')

TA_cp<-cbind(cp_tot_f, (cp_tot_f*900)/1000000)
colnames(TA_cp)<-c('TRC','TA')
TA_cp<-as.data.frame(TA_cp)
TA_c<-cbind(c_tot_f, (c_tot_f*900)/1000000)
colnames(TA_c)<-c('TRC','TA')
TA_c<-as.data.frame(TA_c)


##all available area
#percent area
out_cpa<-(out_c/TA_c$TRC)*100
out_cppa<-(out_cp/TA_cp$TRC)*100
out_allpa<-cbind(out_cpa,out_cppa)

#total area (km2)
out_cta<-(out_c*900)/1000000
out_cpta<-(out_cp*900)/1000000
out_allta<-as.data.frame(cbind(out_cta, out_cpta))
names(out_allta)<-names(out_allpa)

##PA
#percent of total PA area
out_PAcpa<-(out_PAbasec/TA_c$TRC)*100
out_PAcppa<-(out_PAbasecp/TA_cp$TRC)*100
out_allPApa<-as.data.frame(cbind(out_PAcpa,out_PAcppa))
names(out_allPApa)<-names(out_allpa)

##percent of PA of available habitat
out_PAchab<-(out_PAbasec/out_c)*100
out_PAcphab<-(out_PAbasecp/out_cp)*100
out_allPAhab<-as.data.frame(cbind(out_PAchab, out_PAcphab))
names(out_allPAhab)<-names(out_allpa)

#total area (km2)
out_PActa<-(out_PAbasec*900)/1000000
out_PAcpta<-(out_PAbasecp*900)/1000000
out_allPAta<-as.data.frame(cbind(out_PActa, out_PAcpta))
names(out_allPAta)<-names(out_allpa)

out_low<-rbind(out_allpa,out_allta, out_allPAhab, out_allPApa,out_allPAta)

namesx<-c('percent total','area total (km2)','percent PA avail hab', 'percent PA ext','area PA (km2)')
rownames(out_low)<-namesx
setwd('E:\\FinalModels\\Scenarios')
write.csv(out_low,"LandAreaCalculations_2mslrHIGH.csv")

save.image(file='landareacalcs2mslrHIGH.RData')






#Urb----